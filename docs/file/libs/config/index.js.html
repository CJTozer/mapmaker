<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">libs/config/index.js | API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <a data-ice="repoURL" href="https://github.com/CJTozer/mapmaker" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">map-builder</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/libs/map-builder/index.js~MapBuilder.html">MapBuilder</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">libs/config/index.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">#!/usr/bin/env node
&apos;use strict&apos;;

const
  Config = require( &apos;merge-config&apos; ),
  hash = require( &apos;object-hash&apos; ),
  path = require( &apos;path&apos; ),
  urljoin = require( &apos;url-join&apos; ),
  utils = require( &apos;../utils&apos; );

// Build up a configuration object from a spec file and/or spec object.
module.exports.build_config = function( spec_file, spec_obj ) {
  var
    built_config,
    config,
    shape_data,
    file_base,
    shape_dir,
    repo_info,
    sha;

  // Get the global defaults then override with the specified specification.
  built_config = new Config();
  built_config.file( path.join( __dirname, &apos;..&apos;, &apos;..&apos;, &apos;defaults.yaml&apos; ) );
  if ( spec_file ) {
    built_config.file( spec_file );
  }
  if ( spec_obj ) {
    built_config.merge( spec_obj );
  }

  // Set up derived config values:
  // - Download dirs and shapefile name
  shape_data = built_config.get( &apos;shape_data&apos; );
  file_base = shape_data.filename.substr( 0, shape_data.filename.lastIndexOf( &apos;.&apos; ) ) || shape_data.filename;
  shape_dir = path.join( &apos;data&apos;, shape_data.repo, shape_data.base, file_base );
  built_config.set( &apos;derived:shape_dir&apos;, shape_dir );
  built_config.set( &apos;derived:shape_file&apos;, path.join( shape_dir, file_base + &apos;.shp&apos; ) );

  // - Info for the current repo
  repo_info = built_config.get( &apos;repos&apos; )[ shape_data.repo ];
  built_config.set( &apos;derived:repo_info&apos;, repo_info );

  // - Download target
  built_config.set( &apos;derived:download_url&apos;, urljoin( repo_info.base_url, shape_data.base, shape_data.filename ) );

  // - SHA of the spec file, and output file.
  sha = hash( built_config.get() );
  built_config.set( &apos;derived:spec_sha1&apos;, sha );
  built_config.set( &apos;derived:output_svg&apos;, path.join( &apos;output&apos;, sha + &apos;.svg&apos; ) );

  // Store off the config as a &apos;normal&apos; object.
  config = built_config.get();
  utils.log.debug( &apos;Full Config&apos;, config );
  return config;
};

// Validate that the supplied filter makes sense for the given data.
module.exports.validate_filter = function validate_filter( config, data ) {
  // @@@ TODO
  return config !== data;
};
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.4.8)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
